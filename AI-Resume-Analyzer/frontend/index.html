<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Resume Analyzer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial; margin:2rem; background:#f8f9fa;}
    h1 {color:#333;}
    form {margin-bottom:2rem; padding:1rem; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    textarea {width:100%; height:120px; margin-top:0.5rem; padding:0.5rem;}
    #output {white-space:pre-wrap; margin-top:1rem; padding:1rem; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    .progress-container {width:100%; background:#e0e0e0; border-radius:8px; margin:1rem 0; height:24px; overflow:hidden;}
    .progress-bar {height:100%; text-align:center; color:white; font-weight:bold; line-height:24px;}
    #chart-container {margin-top:2rem; background:#fff; padding:1rem; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
  </style>
</head>
<body>
<h1>AI-Powered Resume Analyzer</h1>
<form id="resumeForm">
  <label>Upload Resume (PDF/DOCX/TXT):</label><br>
  <input type="file" id="resume" accept=".pdf,.doc,.docx,.txt" required><br><br>
  <label>Paste Job Description:</label><br>
  <textarea id="job_description" required></textarea><br>
  <button type="submit">Analyze Resume</button>
</form>

<div id="output">Results will appear here...</div>
<div class="progress-container" style="display:none;">
  <div id="progress-bar" class="progress-bar"></div>
</div>
<div id="chart-container" style="display:none;">
  <h3>Resume vs Job Description Skills</h3>
  <canvas id="skillsChart"></canvas>
</div>
<button id="downloadPdf" style="display:none;">Download PDF Report</button>

<script>
const form = document.getElementById("resumeForm");
const output = document.getElementById("output");
const progressContainer = document.querySelector(".progress-container");
const progressBar = document.getElementById("progress-bar");
const chartContainer = document.getElementById("chart-container");
const downloadBtn = document.getElementById("downloadPdf");
let skillsChart;

form.addEventListener("submit", async (e)=>{
  e.preventDefault();
  output.innerText="⏳ Analyzing... Please wait.";
  progressContainer.style.display="none";
  chartContainer.style.display="none";
  downloadBtn.style.display="none";

  const formData = new FormData();
  formData.append("resume", document.getElementById("resume").files[0]);
  formData.append("job_description", document.getElementById("job_description").value);

  try{
    const res = await fetch("http://127.0.0.1:8000/analyze_resume/", {method:"POST", body:formData});
    if(!res.ok){const errText=await res.text(); output.innerText=`❌ Error ${res.status}: ${errText}`; return;}
    const data = await res.json();
    const scorePercent=(data.match_score*100).toFixed(2);

    output.innerText=
      `✅ Analysis Complete\n\n📄 Filename: ${data.filename}\n🛠 Skills: ${data.skills.join(", ")}\n📊 Match Score: ${scorePercent}%\n💡 Suggestions: ${data.suggestions.join(", ")}`;

    // Progress Bar
    progressContainer.style.display="block";
    progressBar.style.width=scorePercent+"%";
    progressBar.style.background=scorePercent>=70?"#28a745":scorePercent>=40?"#ffc107":"#dc3545";
    progressBar.innerText=scorePercent+"%";

    // Chart.js
    chartContainer.style.display="block";
    const labels=[...new Set([...data.skills,...data.suggestions])];
    const resumeSkills=labels.map(s=>data.skills.includes(s)?1:0);
    const jdSkills=labels.map(s=>(data.suggestions.includes(s)||data.skills.includes(s))?1:0);
    if(skillsChart) skillsChart.destroy();
    const ctx=document.getElementById("skillsChart").getContext("2d");
    skillsChart=new Chart(ctx,{type:"bar", data:{labels:labels,datasets:[
      {label:"Resume", data:resumeSkills, backgroundColor:"rgba(54, 162, 235,0.7)"},
      {label:"Job Description", data:jdSkills, backgroundColor:"rgba(255,99,132,0.7)"}
    ]}, options:{responsive:true, scales:{y:{beginAtZero:true, ticks:{stepSize:1}}}}});

    // Show PDF button
    downloadBtn.style.display="inline-block";

  }catch(err){output.innerText=`🚨 Request failed: ${err.message}`; console.error(err);}
});

// PDF download
downloadBtn.addEventListener("click", ()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const lines = output.innerText.split("\n");
  let y=20;
  lines.forEach(line=>{doc.text(line,20,y); y+=10;});
  doc.save("Resume_Analysis_Report.pdf");
});
</script>
</body>
</html>
